<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CamRuler - Camera Measurement Tool</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="container">
        <!-- Loading indicator -->
        <div id="loading" hidden>
            <div>Loading OpenCV.js...</div>
            <div>Please wait...</div>
        </div>

        <!-- Start controls -->
        <div class="start-controls">
            <div class="start-column">
                <button id="startBtn">Start Camera</button>
            </div>
        </div>

        <!-- Control panel -->
        <div id="controls" class="control-panel" aria-label="Controls">
            <button type="button" data-action="quit" title="Quit (Q)">Quit</button>
            <button type="button" data-action="config" title="Config (C)">Config</button>
            <button type="button" data-action="norms" title="Normalize (N)">Normalize</button>
            <button type="button" data-action="rotate" title="Rotate (R)">Rotate</button>
            <button type="button" data-action="auto" title="Auto (A)">Auto</button>
            <button type="button" id="footerToggle" title="Toggle footer">Toggle Footer</button>
            <button type="button" id="debugToggle" title="Toggle debug logs">Debug</button>
            <button type="button" id="binaryToggle" title="Toggle binary view">Binary: OFF</button>
            <button type="button" id="shadowToggle" title="Toggle shadow removal">Shadow Removal: OFF</button>
        </div>

        <!-- Footer with camera controls, save settings, and logs -->
        <footer id="appFooter">
            <!-- Gallery link -->
            <div class="footer-links">
                <button id="openDetail" title="Open detail page">
                    Informatsiya pro vymiryanyi obiekt
                </button>
            </div>

            <!-- Camera selection -->
            <div class="footer-camera">
                <label for="cameraSelect">Camera:</label>
                <select id="cameraSelect" aria-label="Select camera">
                    <option value="">Default camera</option>
                </select>
                <button id="cameraRefresh" title="Refresh camera list">‚ü≥</button>
                <button id="cameraRequest" title="Request camera permission">Allow</button>
            </div>

            <!-- Save controls -->
            <div class="save-controls">
                <label>
                    <input type="checkbox" id="autoSave" />
                    Auto-save detections
                </label>
                <button id="chooseFolder" title="Choose save folder">
                    Choose Folder
                </button>
                <label class="object-name-label">
                    Object name:
                    <input id="objectName" type="text" placeholder="Enter object name (manual)" />
                </label>
                <button id="exportCsvBtn" title="Export all CSVs">
                    Export All CSV
                </button>
                <button id="saveCalBtn" title="Save Calibration">Save Cal</button>
                <button id="loadCalBtn" title="Load Calibration">Load Cal</button>
                <input type="file" id="calFileInput" accept=".json" style="display: none;" />
                <span id="saveFolderLabel" class="save-folder-label">
                    (no folder)
                </span>
            </div>

            <!-- Advanced Calibration Controls -->
            <div class="calibration-controls">
                <h3>üéØ Advanced Calibration</h3>

                <!-- Calibration Mode Slider -->
                <div class="calib-mode-slider">
                    <div class="slider-labels">
                        <span>Manual</span>
                        <span>ArUco</span>
                        <span>Chessboard</span>
                    </div>
                    <input type="range" id="calibModeSlider" min="0" max="2" value="0" step="1" />
                    <div class="slider-indicator" id="calibModeIndicator">Manual Calibration</div>
                </div>

                <!-- ArUco Controls -->
                <div class="calib-panel" id="arucoPanel" style="display: none;">
                    <div class="calib-row">
                        <label for="markerSize">Marker Size (mm):</label>
                        <input type="number" id="markerSize" value="50" min="10" max="500" step="5" />
                    </div>
                    <div class="calib-buttons">
                        <button id="startArucoCalib" class="calib-btn">üì∑ Detect Marker</button>
                        <a href="aruco_marker.html" target="_blank" class="link-btn">üéØ Generate Marker</a>
                    </div>
                </div>

                <!-- Chessboard Controls -->
                <div class="calib-panel" id="chessPanel" style="display: none;">
                    <div class="calib-row">
                        <label for="chessSquareSize">Square Size (mm):</label>
                        <input type="number" id="chessSquareSize" value="25" min="5" max="100" step="1" />
                    </div>
                    <div class="calib-row">
                        <label for="chessPatternSize">Pattern:</label>
                        <select id="chessPatternSize">
                            <option value="9x6" selected>9x6 (recommended)</option>
                            <option value="7x5">7x5</option>
                            <option value="10x7">10x7</option>
                            <option value="8x6">8x6</option>
                        </select>
                    </div>
                    <div class="calib-buttons">
                        <button id="startChessCalib" class="calib-btn">üì∑ Capture (<span
                                id="chessImageCount">0</span>)</button>
                        <button id="computeChessCalib" class="calib-btn" disabled>üßÆ Compute</button>
                        <button id="clearChessImages" class="calib-btn-secondary">üóëÔ∏è Clear</button>
                        <a href="chessboard_pattern.html" target="_blank" class="link-btn">‚ôüÔ∏è Generate Pattern</a>
                    </div>
                </div>

                <!-- Manual Calibration Info -->
                <div class="calib-panel" id="manualPanel">
                    <p class="calib-info">Press <kbd>C</kbd> to enter manual calibration mode. Click on objects of known
                        size.</p>
                </div>

                <!-- Calibration Status -->
                <div id="calibStatus" class="calib-status"></div>
            </div>

            <!-- Log panel -->
            <div class="log-panel">
                <div class="log-header">
                    <span>Logs</span>
                    <div class="log-controls">
                        <button id="logToggle" title="Toggle logs">‚ñæ</button>
                        <button id="logClear" title="Clear logs">Clear</button>
                        <button id="logDownload" title="Download logs">Download</button>
                    </div>
                </div>
                <div id="logBody" class="log-body"></div>
            </div>
        </footer>

        <!-- Video and canvas elements -->
        <video id="video" autoplay></video>
        <canvas id="canvas"></canvas>
        <div id="info"></div>
    </div>

    <!-- Scripts -->
    <script src="logger.js" defer></script>
    <script src="csvstore.js" defer></script>
    <script src="shadowremoval.js" defer></script>
    <script src="calibration.js" defer></script>
    <script src="menu.js" defer></script>
    <script src="camruler.js" defer></script>
    <script src="gallery.js" defer></script>
    <script src="boot.js" defer></script>
    <script async src="https://docs.opencv.org/4.5.2/opencv.js" onload="onOpenCvReady();"
        type="text/javascript"></script>
</body>

</html>