<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chessboard Pattern Generator - CamRuler</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 900px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #444;
        }

        input,
        select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #f5576c;
        }

        .pattern-preview {
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            overflow: auto;
        }

        #chessboardCanvas {
            border: 2px solid #333;
            background: white;
            max-width: 100%;
        }

        .info {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .info h3 {
            color: #f57c00;
            margin-bottom: 8px;
        }

        .info p {
            color: #555;
            line-height: 1.6;
        }

        .warning {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .warning h3 {
            color: #c62828;
            margin-bottom: 8px;
        }

        .buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            min-width: 150px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(245, 87, 108, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #333;
        }

        @media print {
            body {
                background: white;
            }

            .container {
                box-shadow: none;
                padding: 0;
            }

            .controls,
            .buttons,
            .info,
            .warning,
            .stats,
            h1,
            .subtitle {
                display: none;
            }

            .pattern-preview {
                border: none;
                padding: 0;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>‚ôüÔ∏è Chessboard Pattern Generator</h1>
        <p class="subtitle">Generate printable chessboard patterns for camera calibration</p>

        <div class="info">
            <h3>üìã Instructions</h3>
            <p>
                1. Set square size (measure after printing!)<br>
                2. Choose pattern size (9x6 recommended)<br>
                3. Download or print the pattern<br>
                4. Mount on FLAT, RIGID surface (foam board recommended)<br>
                5. In CamRuler, show pattern from 5-10 different angles<br>
                6. Compute calibration for lens distortion correction
            </p>
        </div>

        <div class="warning">
            <h3>‚ö†Ô∏è Important</h3>
            <p>
                The pattern MUST be perfectly flat! Any warping will ruin calibration.<br>
                Measure the actual square size after printing - printers may scale slightly.
            </p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="squareSize">Square Size (mm):</label>
                <input type="number" id="squareSize" value="25" min="5" max="100" step="1">
            </div>

            <div class="control-group">
                <label for="patternSize">Pattern Size:</label>
                <select id="patternSize">
                    <option value="9x6" selected>9x6 (recommended)</option>
                    <option value="7x5">7x5 (smaller)</option>
                    <option value="10x7">10x7 (larger)</option>
                    <option value="8x6">8x6 (standard)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="marginSize">Margin (mm):</label>
                <input type="number" id="marginSize" value="20" min="0" max="50" step="5">
            </div>

            <div class="control-group">
                <label for="showLabels">Show Labels:</label>
                <select id="showLabels">
                    <option value="true" selected>Yes</option>
                    <option value="false">No (for printing)</option>
                </select>
            </div>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">Internal Corners</div>
                <div class="stat-value" id="cornersCount">48</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Total Size</div>
                <div class="stat-value" id="totalSize">225mm</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Pattern</div>
                <div class="stat-value" id="patternDisplay">9x6</div>
            </div>
        </div>

        <div class="pattern-preview">
            <canvas id="chessboardCanvas"></canvas>
        </div>

        <div class="buttons">
            <button class="btn-primary" onclick="downloadPattern()">üíæ Download PNG</button>
            <button class="btn-primary" onclick="window.print()">üñ®Ô∏è Print</button>
            <button class="btn-secondary" onclick="window.location.href='index.html'">‚Üê Back to CamRuler</button>
        </div>
    </div>

    <script>
        function generateChessboard() {
            const squareSize = parseInt(document.getElementById('squareSize').value);
            const patternSize = document.getElementById('patternSize').value;
            const marginSize = parseInt(document.getElementById('marginSize').value);
            const showLabels = document.getElementById('showLabels').value === 'true';

            const [cols, rows] = patternSize.split('x').map(Number);

            // Calculate canvas size
            const pixelsPerMM = 3; // 3 pixels per mm for good resolution
            const squarePx = squareSize * pixelsPerMM;
            const marginPx = marginSize * pixelsPerMM;
            const canvasWidth = (cols * squarePx) + (2 * marginPx);
            const canvasHeight = (rows * squarePx) + (2 * marginPx);

            // Update stats
            const internalCorners = (cols - 1) * (rows - 1);
            const totalSizeMM = Math.max(cols * squareSize, rows * squareSize) + (2 * marginSize);
            document.getElementById('cornersCount').textContent = internalCorners;
            document.getElementById('totalSize').textContent = totalSizeMM + 'mm';
            document.getElementById('patternDisplay').textContent = patternSize;

            // Create canvas
            const canvas = document.getElementById('chessboardCanvas');
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            const ctx = canvas.getContext('2d');

            // Fill white background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);

            // Draw chessboard
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const isBlack = (row + col) % 2 === 0;
                    ctx.fillStyle = isBlack ? 'black' : 'white';

                    const x = marginPx + (col * squarePx);
                    const y = marginPx + (row * squarePx);

                    ctx.fillRect(x, y, squarePx, squarePx);
                }
            }

            // Draw border
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;
            ctx.strokeRect(marginPx, marginPx, cols * squarePx, rows * squarePx);

            // Draw labels if enabled
            if (showLabels) {
                ctx.fillStyle = 'red';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';

                // Title
                ctx.fillText(
                    `Chessboard ${cols}x${rows} | Square: ${squareSize}mm`,
                    canvasWidth / 2,
                    marginPx / 2
                );

                // Corner markers
                ctx.fillStyle = 'blue';
                ctx.font = 'bold 14px Arial';

                // Mark internal corners
                for (let row = 1; row < rows; row++) {
                    for (let col = 1; col < cols; col++) {
                        const x = marginPx + (col * squarePx);
                        const y = marginPx + (row * squarePx);

                        ctx.beginPath();
                        ctx.arc(x, y, 4, 0, 2 * Math.PI);
                        ctx.fill();
                    }
                }

                // Instructions
                ctx.fillStyle = 'black';
                ctx.font = '12px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(`Internal corners: ${internalCorners}`, marginPx, canvasHeight - marginPx / 3);
                ctx.textAlign = 'right';
                ctx.fillText(`Measure actual size after printing!`, canvasWidth - marginPx, canvasHeight - marginPx / 3);
            }
        }

        function downloadPattern() {
            const canvas = document.getElementById('chessboardCanvas');
            const squareSize = document.getElementById('squareSize').value;
            const patternSize = document.getElementById('patternSize').value;

            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `chessboard_${patternSize}_${squareSize}mm.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }

        // Event listeners
        document.getElementById('squareSize').addEventListener('input', generateChessboard);
        document.getElementById('patternSize').addEventListener('change', generateChessboard);
        document.getElementById('marginSize').addEventListener('input', generateChessboard);
        document.getElementById('showLabels').addEventListener('change', generateChessboard);

        // Generate on load
        generateChessboard();
    </script>
</body>

</html>